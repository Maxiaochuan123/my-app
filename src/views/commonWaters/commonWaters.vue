<!--
 * @Description: 公海
 * @Author: shenah
 -->
<template>
  <div class="common-waters">
    <AppBar
      :isShowRightBtn="false"
      pageTitle="公海"
    ></AppBar>
    <SearchInputBar
      :type="active"
      @searchInputBarChange="searchInputBarChange"
      placeholderText="搜索"
      ref="searchInputBar"
    ></SearchInputBar>
    <mu-tabs
      :value.sync="active"
      @change="tabsChange"
      center
      class="tabs"
      color="primary"
      indicator-color="primary"
      inverse
    >
      <mu-tab value="clue">公海线索</mu-tab>
      <mu-tab value="customer">公海客户</mu-tab>
    </mu-tabs>
    <div class="content">
      <CommonWatersClue v-if="active === 'clue'"></CommonWatersClue>
      <CommonWatersPeople v-else></CommonWatersPeople>
    </div>
  </div>
</template>

<script>
import { mapState } from "vuex";
import AppBar from "@components/AppBar.vue";
import SearchInputBar from "@components/SearchInputBar.vue";
import CommonWatersClue from "./commonWatersClue";
import CommonWatersPeople from "./commonWatersPeople";
import Api from "@api";
export default {
  name: "commonWaters",
  components: { AppBar, SearchInputBar, CommonWatersClue, CommonWatersPeople },
  data() {
    return {
      requestParams: {
        search: "",
        type: "8"
      },
      active: "clue", // 当前激活
      customerList: [], // 客户列表
      clueList: [] // 线索列表
    };
  },
  computed: {
    ...mapState({
      poolRights: state => state.authorities.crm.pool
    })
  },
  props: {},
  created() {},
  mounted() {
    this.judgeActiveTab();
  },
  methods: {
    searchInputBarChange(obj) {
      const { type, value } = obj;
      this.requestParams.search = value;
      if (type === "clue") {
        this.queryPublicPoolClue();
      } else {
        this.queryPublicPoolCustomer();
      }
    },
    queryPublicPoolClue() {
      // 查询公海线索
      Api.queryCommonWaterClueList(this.requestParams).then(res => {
        let list = [];
        Object.keys(res.data).forEach(item => {
          list.push(...res.data[item]);
        });
        this.clueList = list;
      });
    },
    queryPublicPoolCustomer() {
      // 查询公海客户
      Api.queryPublicPoolCustomer(this.requestParams).then(res => {
        let list = [];
        Object.keys(res.data).forEach(item => {
          list.push(...res.data[item]);
        });
        this.customerList = list;
      });
    },
    judgeActiveTab() {
      this.requestParams.search = "";
      this.active = "clue";
      this.queryPublicPoolClue();
    },
    tabsChange(val) {
      this.active = val;
      this.requestParams.search = "";
      this.$refs.searchInputBar.inputValue = "";
      if (val === "clue") {
        // 线索
        this.queryPublicPoolClue();
      } else {
        this.requestParams.type = "8";
        // 公海客户
        this.queryPublicPoolCustomer();
      }
    }
  }
};
</script>
<style lang='less' scoped>
.common-waters {
  width: 100%;
  height: 100%;
  overflow: hidden;
  .tabs {
    position: fixed;
    top: 104px;
  }
  .content {
    height: 100%;
    padding-top: 172px;
    overflow: hidden;
  }
}
</style>